# Detect Sleep States

**Автор:** Процкий Сергей

## Постановка задачи

Даны данные нескольких людей за ± месяц жизни. Нужно определить, когда они спят,
а когда бодрствуют. Из плюсов — нет людей с какими-то сильными нарушениями сна.

## Формат входных и выходных данных

Мы хотим принимать временной ряд из двух значений (данные с датчиков
акселерометра) и по нему определять промежутки сна и бодрствования, а также
степень уверенности по каждому промежутку.

В `train` даны длинные временные ряды с указанием правильных интервалов
сна/бодрствования.

## Метрики

Базовые метрики (accuracy, F1) не очень хорошо подходят. Используется метрика,
похожая на **IoU**, но также учитывающая **вероятности** и **пороговые
значения**.

## Валидация

- Разделить пользователей: одни в `train`, другие в `test`.
- Зафиксировать seed у `random.shuffle` или сохранить отдельные индексы, если
  нужна высокая повторяемость.

## Данные

[Ссылка на данные с Kaggle](https://www.kaggle.com/competitions/child-mind-institute-detect-sleep-states/data)
Это просто временные ряды. Их не очень много, но они **длинные**. Если в одно и
тоже время дня датчики показывают одинаковые значения, то это измерение
считается каким-то бракованным. Не сильно понял из-за чего так, но там
достаточно большие интервалы такие.

## Моделирование

### Основная модель

Описание:
https://www.kaggle.com/competitions/child-mind-institute-detect-sleep-states/discussion/460274

Код: в начале обсуждения на Kaggle.

Основная идея:

- **UNet с 1D-свертками**
- Основная задача: **сгладить временной ряд в ответе**

### Препроцессинг

- разбиваем ряды по дням + добавляем последние 3 часа предыдущего дня и первые 3
  часа следующего (итого 30 часов в одном образце данных)
- немного сглаживаем моменты пробуждения/засыпания чтобы сверткам легче было

### Постпроцессинг

- использование `scipy.signal.find_peaks` для определения моментов засыпания и
  пробуждения.
- выписывание моментов пробуждения/засыпания из временных рядов и степень
  уверенности

## Внедрение

Модель будет использоваться как **веб-сервис**. План:

- Flask-приложение
- Пользователь загружает `.csv` с акселерометром
- Получает **графики по своему сну**
